<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hugo ç•™è¨€ç³»çµ± - åŠŸèƒ½æ¸¬è©¦é </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .test-section {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .test-item {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 8px 8px 0;
        }

        .test-item h3 {
            color: #495057;
            margin-bottom: 1rem;
        }

        .test-item p {
            margin-bottom: 1rem;
            color: #6c757d;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .input-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .input-row label {
            min-width: 100px;
            font-weight: 600;
        }

        .input-row input,
        .input-row textarea,
        .input-row select {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .input-row textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 1rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .response-box {
            background: #1e1e1e;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 1rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid #444;
        }

        .status {
            padding: 0.75rem;
            border-radius: 6px;
            margin-top: 1rem;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .star-rating {
            display: flex;
            gap: 0.25rem;
            margin: 0.5rem 0;
        }

        .star {
            font-size: 1.5rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.2s;
        }

        .star:hover,
        .star.active {
            color: #ffc107;
        }

        .user-info {
            background: #e8f5e8;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            display: none;
        }

        .avatar-preview {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 1rem;
        }

        .comments-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 1rem 0;
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #666;
        }

        .comment-avatar {
            width: 24px;
            height: 24px;
            border-radius: 50%;
        }

        .comment-content {
            margin-bottom: 0.5rem;
        }

        .reply {
            margin-left: 2rem;
            border-left: 2px solid #ddd;
            padding-left: 1rem;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .input-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .input-row label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Hugo ç•™è¨€ç³»çµ±åŠŸèƒ½æ¸¬è©¦</h1>
            <p>å®Œæ•´åŠŸèƒ½æ¸¬è©¦é é¢ - åœ¨æ­¤æ¸¬è©¦æ‰€æœ‰ API åŠŸèƒ½ä¸¦æŸ¥çœ‹è©³ç´°å›æ‡‰</p>
        </div>

        <!-- ç³»çµ±ç‹€æ…‹ -->
        <div class="test-section">
            <h2>ğŸ“Š ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
            <div class="test-item">
                <h3>API é€£ç·šæ¸¬è©¦</h3>
                <p>æª¢æŸ¥å¾Œç«¯æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œ</p>
                <button class="btn btn-primary" onclick="checkAPIStatus()">æª¢æŸ¥ API ç‹€æ…‹</button>
                <div id="api-status"></div>
            </div>
        </div>

        <!-- ç”¨æˆ¶èªè­‰æ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ” ç”¨æˆ¶èªè­‰åŠŸèƒ½</h2>
            
            <!-- è¨»å†Šæ¸¬è©¦ -->
            <div class="test-item">
                <h3>ç”¨æˆ¶è¨»å†Š</h3>
                <p>æ¸¬è©¦æ–°ç”¨æˆ¶è¨»å†ŠåŠŸèƒ½</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>é›»å­ä¿¡ç®±:</label>
                        <input type="email" id="register-email" placeholder="test@example.com">
                    </div>
                    <div class="input-row">
                        <label>æš±ç¨±:</label>
                        <input type="text" id="register-nickname" placeholder="æ¸¬è©¦ç”¨æˆ¶">
                    </div>
                    <div class="input-row">
                        <label>å¯†ç¢¼:</label>
                        <input type="password" id="register-password" placeholder="è‡³å°‘6å€‹å­—å…ƒ">
                    </div>
                </div>
                <button class="btn btn-success" onclick="testRegister()">æ¸¬è©¦è¨»å†Š</button>
                <div id="register-response"></div>
            </div>

            <!-- ç™»å…¥æ¸¬è©¦ -->
            <div class="test-item">
                <h3>ç”¨æˆ¶ç™»å…¥</h3>
                <p>æ¸¬è©¦ç”¨æˆ¶ç™»å…¥åŠŸèƒ½</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>é›»å­ä¿¡ç®±:</label>
                        <input type="email" id="login-email" placeholder="test@example.com">
                    </div>
                    <div class="input-row">
                        <label>å¯†ç¢¼:</label>
                        <input type="password" id="login-password" placeholder="å¯†ç¢¼">
                    </div>
                </div>
                <button class="btn btn-success" onclick="testLogin()">æ¸¬è©¦ç™»å…¥</button>
                <button class="btn btn-warning" onclick="loginAsAdmin()">ç®¡ç†å“¡ç™»å…¥</button>
                <button class="btn btn-secondary" onclick="testLogout()">ç™»å‡º</button>
                <div id="login-response"></div>
                
                <!-- ç™»å…¥å¾Œçš„ç”¨æˆ¶è³‡è¨Š -->
                <div class="user-info" id="user-info">
                    <h4>ç›®å‰ç™»å…¥ç”¨æˆ¶</h4>
                    <div id="current-user"></div>
                </div>
            </div>

            <!-- å–å¾—ç”¨æˆ¶è³‡è¨Š -->
            <div class="test-item">
                <h3>ç”¨æˆ¶è³‡è¨ŠæŸ¥è©¢</h3>
                <p>æ¸¬è©¦å–å¾—ç›®å‰ç™»å…¥ç”¨æˆ¶çš„è©³ç´°è³‡è¨Š</p>
                <button class="btn btn-primary" onclick="testGetUserInfo()">å–å¾—ç”¨æˆ¶è³‡è¨Š</button>
                <div id="userinfo-response"></div>
            </div>
        </div>

        <!-- å€‹äººæª”æ¡ˆç®¡ç† -->
        <div class="test-section">
            <h2>ğŸ‘¤ å€‹äººæª”æ¡ˆç®¡ç†</h2>
            
            <!-- æª”æ¡ˆæŸ¥è©¢ -->
            <div class="test-item">
                <h3>æŸ¥è©¢å€‹äººæª”æ¡ˆ</h3>
                <p>å–å¾—å®Œæ•´çš„å€‹äººæª”æ¡ˆè³‡è¨Šï¼ŒåŒ…å«é ­åƒ</p>
                <button class="btn btn-primary" onclick="testGetProfile()">æŸ¥è©¢æª”æ¡ˆ</button>
                <div id="profile-response"></div>
            </div>

            <!-- æª”æ¡ˆæ›´æ–° -->
            <div class="test-item">
                <h3>æ›´æ–°å€‹äººæª”æ¡ˆ</h3>
                <p>ä¿®æ”¹ç”¨æˆ¶æš±ç¨±</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>æ–°æš±ç¨±:</label>
                        <input type="text" id="new-nickname" placeholder="æ–°çš„æš±ç¨±">
                    </div>
                </div>
                <button class="btn btn-warning" onclick="testUpdateProfile()">æ›´æ–°æš±ç¨±</button>
                <div id="update-profile-response"></div>
            </div>

            <!-- é ­åƒä¸Šå‚³ -->
            <div class="test-item">
                <h3>é ­åƒä¸Šå‚³</h3>
                <p>ä¸Šå‚³ä¸¦æ¸¬è©¦é ­åƒåŠŸèƒ½ (æœƒè‡ªå‹•å£“ç¸®è‡³ 64x64)</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>é¸æ“‡é ­åƒ:</label>
                        <input type="file" id="avatar-file" accept="image/*">
                    </div>
                </div>
                <button class="btn btn-success" onclick="testUploadAvatar()">ä¸Šå‚³é ­åƒ</button>
                <button class="btn btn-danger" onclick="testDeleteAvatar()">åˆªé™¤é ­åƒ</button>
                <div id="avatar-response"></div>
            </div>

            <!-- å¯†ç¢¼ä¿®æ”¹ -->
            <div class="test-item">
                <h3>å¯†ç¢¼ä¿®æ”¹</h3>
                <p>æ¸¬è©¦ä¿®æ”¹å¯†ç¢¼åŠŸèƒ½</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>ç›®å‰å¯†ç¢¼:</label>
                        <input type="password" id="current-password" placeholder="ç›®å‰å¯†ç¢¼">
                    </div>
                    <div class="input-row">
                        <label>æ–°å¯†ç¢¼:</label>
                        <input type="password" id="new-password" placeholder="æ–°å¯†ç¢¼">
                    </div>
                </div>
                <button class="btn btn-warning" onclick="testChangePassword()">ä¿®æ”¹å¯†ç¢¼</button>
                <div id="password-response"></div>
            </div>
        </div>

        <!-- ç•™è¨€åŠŸèƒ½æ¸¬è©¦ -->
        <div class="test-section">
            <h2>ğŸ’¬ ç•™è¨€èˆ‡è©•åˆ†åŠŸèƒ½</h2>
            
            <!-- æ–‡ç« è¨­å®š -->
            <div class="test-item">
                <h3>æ¸¬è©¦æ–‡ç« è¨­å®š</h3>
                <p>è¨­å®šè¦æ¸¬è©¦çš„æ–‡ç«  ID</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>æ–‡ç«  ID:</label>
                        <input type="text" id="test-post-id" value="test-article-1" placeholder="æ–‡ç«  ID">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="setTestPostId()">è¨­å®šæ–‡ç«  ID</button>
                <div id="post-id-status"></div>
            </div>

            <!-- è©•åˆ†æ¸¬è©¦ -->
            <div class="test-item">
                <h3>æ–‡ç« è©•åˆ†</h3>
                <p>ç‚ºæ–‡ç« è©•åˆ† (1-5 æ˜Ÿ)</p>
                <div class="star-rating" id="rating-stars">
                    <span class="star" data-rating="1">â˜…</span>
                    <span class="star" data-rating="2">â˜…</span>
                    <span class="star" data-rating="3">â˜…</span>
                    <span class="star" data-rating="4">â˜…</span>
                    <span class="star" data-rating="5">â˜…</span>
                </div>
                <button class="btn btn-success" onclick="testRating()">æäº¤è©•åˆ†</button>
                <button class="btn btn-primary" onclick="testGetUserRating()">æŸ¥è©¢æˆ‘çš„è©•åˆ†</button>
                <div id="rating-response"></div>
            </div>

            <!-- ç•™è¨€æ¸¬è©¦ -->
            <div class="test-item">
                <h3>ç™¼è¡¨ç•™è¨€</h3>
                <p>æ¸¬è©¦ç•™è¨€ç™¼è¡¨åŠŸèƒ½ï¼ˆæ”¯æ´æ¨™é¡Œï¼‰</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>ç•™è¨€æ¨™é¡Œ:</label>
                        <input type="text" id="comment-title" placeholder="ç•™è¨€æ¨™é¡Œ (é¸å¡«ï¼Œæœ€å¤š200å­—)" maxlength="200">
                    </div>
                    <div class="input-row">
                        <label>ç•™è¨€å…§å®¹:</label>
                        <textarea id="comment-content" placeholder="å¯«ä¸‹ä½ çš„ç•™è¨€..."></textarea>
                    </div>
                    <div class="input-row">
                        <label>åŒæ™‚è©•åˆ†:</label>
                        <select id="comment-rating">
                            <option value="">ä¸è©•åˆ†</option>
                            <option value="1">1 æ˜Ÿ</option>
                            <option value="2">2 æ˜Ÿ</option>
                            <option value="3">3 æ˜Ÿ</option>
                            <option value="4">4 æ˜Ÿ</option>
                            <option value="5">5 æ˜Ÿ</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-success" onclick="testPostComment()">ç™¼è¡¨ç•™è¨€</button>
                <div id="comment-response"></div>
            </div>

            <!-- å›è¦†æ¸¬è©¦ -->
            <div class="test-item">
                <h3>å›è¦†ç•™è¨€</h3>
                <p>æ¸¬è©¦å›è¦†åŠŸèƒ½ (éœ€è¦å…ˆæœ‰ç•™è¨€å­˜åœ¨)</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>çˆ¶ç•™è¨€ ID:</label>
                        <input type="text" id="parent-comment-id" placeholder="è¦å›è¦†çš„ç•™è¨€ ID">
                    </div>
                    <div class="input-row">
                        <label>å›è¦†å…§å®¹:</label>
                        <textarea id="reply-content" placeholder="å¯«ä¸‹ä½ çš„å›è¦†..."></textarea>
                    </div>
                </div>
                <button class="btn btn-success" onclick="testReplyComment()">ç™¼è¡¨å›è¦†</button>
                <div id="reply-response"></div>
            </div>

            <!-- æŸ¥è©¢ç•™è¨€ -->
            <div class="test-item">
                <h3>æŸ¥è©¢æ–‡ç« ç•™è¨€</h3>
                <p>è¼‰å…¥æŒ‡å®šæ–‡ç« çš„æ‰€æœ‰ç•™è¨€å’Œè©•åˆ†çµ±è¨ˆ</p>
                <button class="btn btn-primary" onclick="testGetComments()">è¼‰å…¥ç•™è¨€</button>
                <button class="btn btn-secondary" onclick="testGetComments(2)">è¼‰å…¥ç¬¬äºŒé </button>
                <div id="comments-response"></div>
                
                <!-- ç•™è¨€åˆ—è¡¨é¡¯ç¤º -->
                <div class="comments-list" id="comments-display" style="display: none;">
                    <h4>ç•™è¨€åˆ—è¡¨</h4>
                    <div id="comments-content"></div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†åŠŸèƒ½æ¸¬è©¦ -->
        <div class="test-section">
            <h2>âš™ï¸ ç®¡ç†åŠŸèƒ½æ¸¬è©¦</h2>
            
            <!-- ç®¡ç†é¢æ¿ -->
            <div class="test-item">
                <h3>ç®¡ç†é¢æ¿è³‡è¨Š</h3>
                <p>å–å¾—ç®¡ç†é¢æ¿çµ±è¨ˆè³‡æ–™ (éœ€è¦ç®¡ç†å“¡æ¬Šé™)</p>
                <button class="btn btn-primary" onclick="testAdminDashboard()">è¼‰å…¥é¢æ¿</button>
                <div id="admin-dashboard-response"></div>
            </div>

            <!-- ç”¨æˆ¶ç®¡ç† -->
            <div class="test-item">
                <h3>ç”¨æˆ¶ç®¡ç†</h3>
                <p>æŸ¥è©¢å’Œç®¡ç†ç”¨æˆ¶</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>æœå°‹ç”¨æˆ¶:</label>
                        <input type="text" id="user-search" placeholder="é›»å­ä¿¡ç®±æˆ–æš±ç¨±">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="testGetUsers()">æŸ¥è©¢ç”¨æˆ¶åˆ—è¡¨</button>
                <button class="btn btn-warning" onclick="testSearchUsers()">æœå°‹ç”¨æˆ¶</button>
                <div id="users-response"></div>
            </div>

            <!-- ç•™è¨€ç®¡ç† -->
            <div class="test-item">
                <h3>ç•™è¨€ç®¡ç†</h3>
                <p>ç®¡ç†å“¡æŸ¥çœ‹å’Œç®¡ç†ç•™è¨€</p>
                <div class="input-group">
                    <div class="input-row">
                        <label>ç•™è¨€ ID:</label>
                        <input type="text" id="manage-comment-id" placeholder="è¦ç®¡ç†çš„ç•™è¨€ ID">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="testGetAdminComments()">æŸ¥è©¢æ‰€æœ‰ç•™è¨€</button>
                <button class="btn btn-warning" onclick="testHideComment()">éš±è—ç•™è¨€</button>
                <button class="btn btn-danger" onclick="testDeleteAdminComment()">åˆªé™¤ç•™è¨€</button>
                <div id="admin-comments-response"></div>
            </div>

            <!-- çµ±è¨ˆè³‡æ–™ -->
            <div class="test-item">
                <h3>çµ±è¨ˆè³‡æ–™</h3>
                <p>æŸ¥çœ‹è©³ç´°çš„ç³»çµ±çµ±è¨ˆ</p>
                <button class="btn btn-primary" onclick="testGetStats()">è¼‰å…¥çµ±è¨ˆ</button>
                <div id="stats-response"></div>
            </div>
        </div>

        <!-- API å›æ‡‰æ—¥èªŒ -->
        <div class="test-section">
            <h2>ğŸ“‹ API å›æ‡‰æ—¥èªŒ</h2>
            <div class="test-item">
                <h3>å³æ™‚ API æ—¥èªŒ</h3>
                <p>æ‰€æœ‰ API è«‹æ±‚å’Œå›æ‡‰çš„è©³ç´°è¨˜éŒ„</p>
                <button class="btn btn-secondary" onclick="clearApiLog()">æ¸…ç©ºæ—¥èªŒ</button>
                <div class="response-box" id="api-log"></div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let authToken = localStorage.getItem('testToken');
        let currentUser = null;
        let testPostId = 'test-article-1';
        let selectedRating = 0;

        const API_BASE = '/api';

        // API è«‹æ±‚å‡½æ•¸
        async function apiRequest(endpoint, options = {}) {
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...options.headers
                },
                ...options
            };

            if (authToken && !config.headers.Authorization) {
                config.headers.Authorization = `Bearer ${authToken}`;
            }

            const requestTime = new Date().toLocaleTimeString();
            const requestInfo = {
                method: config.method || 'GET',
                url: API_BASE + endpoint,
                headers: config.headers,
                body: config.body
            };

            logAPI(`[${requestTime}] è«‹æ±‚: ${config.method || 'GET'} ${endpoint}`, requestInfo);

            try {
                const response = await fetch(API_BASE + endpoint, config);
                const responseTime = new Date().toLocaleTimeString();
                
                let responseData;
                const contentType = response.headers.get('content-type');
                
                if (contentType && contentType.includes('application/json')) {
                    responseData = await response.json();
                } else {
                    responseData = await response.text();
                }

                const responseInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data: responseData
                };

                if (response.ok) {
                    logAPI(`[${responseTime}] å›æ‡‰: ${response.status} ${response.statusText}`, responseInfo, 'success');
                } else {
                    logAPI(`[${responseTime}] éŒ¯èª¤: ${response.status} ${response.statusText}`, responseInfo, 'error');
                }

                return { success: response.ok, data: responseData, status: response.status };
            } catch (error) {
                const errorTime = new Date().toLocaleTimeString();
                logAPI(`[${errorTime}] ç¶²è·¯éŒ¯èª¤: ${error.message}`, { error: error.message }, 'error');
                return { success: false, error: error.message };
            }
        }

        // æ—¥èªŒå‡½æ•¸
        function logAPI(message, data, type = 'info') {
            const logElement = document.getElementById('api-log');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '1rem';
            logEntry.style.paddingBottom = '1rem';
            logEntry.style.borderBottom = '1px solid #444';
            
            let color = '#f8f8f2';
            if (type === 'success') color = '#a6e22e';
            if (type === 'error') color = '#f92672';
            if (type === 'warning') color = '#fd971f';
            
            logEntry.innerHTML = `
                <div style="color: ${color}; font-weight: bold; margin-bottom: 0.5rem;">${message}</div>
                <div style="color: #75715e; font-size: 0.8rem; margin-bottom: 0.5rem;">${timestamp}</div>
                <div>${JSON.stringify(data, null, 2)}</div>
            `;
            
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearApiLog() {
            document.getElementById('api-log').innerHTML = '';
        }

        // é¡¯ç¤ºç‹€æ…‹å‡½æ•¸
        function showStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        // ç³»çµ±ç‹€æ…‹æª¢æŸ¥
        async function checkAPIStatus() {
            showStatus('api-status', 'æª¢æŸ¥ä¸­...', 'info');
            
            const result = await apiRequest('/auth/me');
            
            if (result.success) {
                showStatus('api-status', 'âœ… API æœå‹™æ­£å¸¸é‹è¡Œ', 'success');
                if (result.data.user) {
                    currentUser = result.data.user;
                    updateUserDisplay();
                }
            } else {
                showStatus('api-status', 'âŒ API æœå‹™ç„¡æ³•é€£æ¥', 'error');
            }
        }

        // è¨»å†Šæ¸¬è©¦
        async function testRegister() {
            const email = document.getElementById('register-email').value;
            const nickname = document.getElementById('register-nickname').value;
            const password = document.getElementById('register-password').value;

            if (!email || !nickname || !password) {
                showStatus('register-response', 'è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½', 'error');
                return;
            }

            showStatus('register-response', 'è¨»å†Šä¸­...', 'info');

            const result = await apiRequest('/auth/register', {
                method: 'POST',
                body: JSON.stringify({ email, nickname, password })
            });

            if (result.success) {
                authToken = result.data.token;
                currentUser = result.data.user;
                localStorage.setItem('testToken', authToken);
                updateUserDisplay();
                showStatus('register-response', 'âœ… è¨»å†ŠæˆåŠŸï¼', 'success');
            } else {
                showStatus('register-response', `âŒ è¨»å†Šå¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // ç™»å…¥æ¸¬è©¦
        async function testLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                showStatus('login-response', 'è«‹å¡«å¯«é›»å­ä¿¡ç®±å’Œå¯†ç¢¼', 'error');
                return;
            }

            showStatus('login-response', 'ç™»å…¥ä¸­...', 'info');

            const result = await apiRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, password })
            });

            if (result.success) {
                authToken = result.data.token;
                currentUser = result.data.user;
                localStorage.setItem('testToken', authToken);
                updateUserDisplay();
                showStatus('login-response', 'âœ… ç™»å…¥æˆåŠŸï¼', 'success');
            } else {
                showStatus('login-response', `âŒ ç™»å…¥å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // ç®¡ç†å“¡ç™»å…¥
        async function loginAsAdmin() {
            // ä½¿ç”¨ç’°å¢ƒè®Šæ•¸ä¸­çš„ç®¡ç†å“¡å¸³è™Ÿ
            document.getElementById('login-email').value = 'admin@example.com';
            document.getElementById('login-password').value = 'admin123';
            await testLogin();
        }

        // ç™»å‡ºæ¸¬è©¦
        function testLogout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('testToken');
            updateUserDisplay();
            showStatus('login-response', 'âœ… å·²ç™»å‡º', 'success');
        }

        // å–å¾—ç”¨æˆ¶è³‡è¨Š
        async function testGetUserInfo() {
            if (!authToken) {
                showStatus('userinfo-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('userinfo-response', 'æŸ¥è©¢ä¸­...', 'info');

            const result = await apiRequest('/auth/me');

            if (result.success) {
                currentUser = result.data.user;
                updateUserDisplay();
                showStatus('userinfo-response', 'âœ… ç”¨æˆ¶è³‡è¨Šå·²æ›´æ–°', 'success');
            } else {
                showStatus('userinfo-response', `âŒ æŸ¥è©¢å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // æŸ¥è©¢å€‹äººæª”æ¡ˆ
        async function testGetProfile() {
            if (!authToken) {
                showStatus('profile-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('profile-response', 'æŸ¥è©¢ä¸­...', 'info');

            const result = await apiRequest('/users/profile');

            if (result.success) {
                showStatus('profile-response', 'âœ… æª”æ¡ˆæŸ¥è©¢æˆåŠŸ', 'success');
                
                // é¡¯ç¤ºé ­åƒ
                if (result.data.user.avatar) {
                    const avatarImg = document.createElement('img');
                    avatarImg.src = result.data.user.avatar;
                    avatarImg.className = 'avatar-preview';
                    document.getElementById('profile-response').appendChild(avatarImg);
                }
            } else {
                showStatus('profile-response', `âŒ æŸ¥è©¢å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // æ›´æ–°å€‹äººæª”æ¡ˆ
        async function testUpdateProfile() {
            if (!authToken) {
                showStatus('update-profile-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const nickname = document.getElementById('new-nickname').value;
            if (!nickname) {
                showStatus('update-profile-response', 'è«‹è¼¸å…¥æ–°æš±ç¨±', 'error');
                return;
            }

            showStatus('update-profile-response', 'æ›´æ–°ä¸­...', 'info');

            const result = await apiRequest('/users/profile', {
                method: 'PUT',
                body: JSON.stringify({ nickname })
            });

            if (result.success) {
                currentUser.nickname = nickname;
                updateUserDisplay();
                showStatus('update-profile-response', 'âœ… æš±ç¨±æ›´æ–°æˆåŠŸ', 'success');
            } else {
                showStatus('update-profile-response', `âŒ æ›´æ–°å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // ä¸Šå‚³é ­åƒ
        async function testUploadAvatar() {
            if (!authToken) {
                showStatus('avatar-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const fileInput = document.getElementById('avatar-file');
            const file = fileInput.files[0];

            if (!file) {
                showStatus('avatar-response', 'è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ', 'error');
                return;
            }

            // æª¢æŸ¥æª”æ¡ˆé¡å‹
            if (!file.type.startsWith('image/')) {
                showStatus('avatar-response', 'âŒ è«‹é¸æ“‡åœ–ç‰‡æª”æ¡ˆ (JPG, PNG, GIF ç­‰)', 'error');
                return;
            }

            // æª¢æŸ¥æª”æ¡ˆå¤§å° (100KB = 100000 bytes)
            const maxSize = 100000;
            if (file.size > maxSize) {
                showStatus('avatar-response', `âŒ æª”æ¡ˆéå¤§ï¼Œè«‹é¸æ“‡å°æ–¼ ${Math.round(maxSize/1024)}KB çš„åœ–ç‰‡`, 'error');
                return;
            }

            showStatus('avatar-response', 'ä¸Šå‚³ä¸­...', 'info');

            const formData = new FormData();
            formData.append('avatar', file);

            const requestTime = new Date().toLocaleTimeString();
            const requestInfo = {
                method: 'POST',
                url: API_BASE + '/users/avatar',
                headers: { 'Authorization': `Bearer ${authToken}` },
                body: `FormData: avatar=${file.name} (${file.size} bytes, ${file.type})`
            };

            logAPI(`[${requestTime}] è«‹æ±‚: POST /users/avatar`, requestInfo);

            try {
                const response = await fetch(API_BASE + '/users/avatar', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const responseTime = new Date().toLocaleTimeString();
                let result;
                
                try {
                    result = await response.json();
                } catch (e) {
                    result = { error: 'Invalid JSON response' };
                }

                const responseInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data: result
                };

                if (response.ok) {
                    logAPI(`[${responseTime}] å›æ‡‰: ${response.status} ${response.statusText}`, responseInfo, 'success');
                    showStatus('avatar-response', 'âœ… é ­åƒä¸Šå‚³æˆåŠŸ', 'success');
                    
                    // é¡¯ç¤ºæ–°é ­åƒ
                    if (result.avatar) {
                        const avatarImg = document.createElement('img');
                        avatarImg.src = result.avatar;
                        avatarImg.className = 'avatar-preview';
                        avatarImg.style.marginTop = '10px';
                        document.getElementById('avatar-response').appendChild(avatarImg);
                    }
                    
                    // æ›´æ–°ç”¨æˆ¶é¡¯ç¤º
                    await testGetUserInfo();
                } else {
                    logAPI(`[${responseTime}] éŒ¯èª¤: ${response.status} ${response.statusText}`, responseInfo, 'error');
                    showStatus('avatar-response', `âŒ ä¸Šå‚³å¤±æ•—: ${result.error || 'æœªçŸ¥éŒ¯èª¤'}`, 'error');
                }
            } catch (error) {
                const errorTime = new Date().toLocaleTimeString();
                logAPI(`[${errorTime}] ç¶²è·¯éŒ¯èª¤: ${error.message}`, { error: error.message }, 'error');
                showStatus('avatar-response', `âŒ ä¸Šå‚³éŒ¯èª¤: ${error.message}`, 'error');
            }
        }

        // åˆªé™¤é ­åƒ
        async function testDeleteAvatar() {
            if (!authToken) {
                showStatus('avatar-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('avatar-response', 'åˆªé™¤ä¸­...', 'info');

            const result = await apiRequest('/users/avatar', {
                method: 'DELETE'
            });

            if (result.success) {
                showStatus('avatar-response', 'âœ… é ­åƒå·²åˆªé™¤', 'success');
                await testGetUserInfo();
            } else {
                showStatus('avatar-response', `âŒ åˆªé™¤å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // ä¿®æ”¹å¯†ç¢¼
        async function testChangePassword() {
            if (!authToken) {
                showStatus('password-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;

            if (!currentPassword || !newPassword) {
                showStatus('password-response', 'è«‹å¡«å¯«æ‰€æœ‰å¯†ç¢¼æ¬„ä½', 'error');
                return;
            }

            showStatus('password-response', 'ä¿®æ”¹ä¸­...', 'info');

            const result = await apiRequest('/users/password', {
                method: 'PUT',
                body: JSON.stringify({ currentPassword, newPassword })
            });

            if (result.success) {
                showStatus('password-response', 'âœ… å¯†ç¢¼ä¿®æ”¹æˆåŠŸ', 'success');
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
            } else {
                showStatus('password-response', `âŒ ä¿®æ”¹å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // è¨­å®šæ¸¬è©¦æ–‡ç«  ID
        function setTestPostId() {
            testPostId = document.getElementById('test-post-id').value || 'test-article-1';
            showStatus('post-id-status', `âœ… æ¸¬è©¦æ–‡ç«  ID è¨­å®šç‚º: ${testPostId}`, 'success');
        }

        // è©•åˆ†åŠŸèƒ½
        function initRatingStars() {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    selectedRating = index + 1;
                    updateStarDisplay(selectedRating);
                });
                
                star.addEventListener('mouseover', () => {
                    updateStarDisplay(index + 1);
                });
            });

            document.getElementById('rating-stars').addEventListener('mouseleave', () => {
                updateStarDisplay(selectedRating);
            });
        }

        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('.star');
            stars.forEach((star, index) => {
                star.classList.toggle('active', index < rating);
            });
        }

        async function testRating() {
            if (!authToken) {
                showStatus('rating-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            if (selectedRating === 0) {
                showStatus('rating-response', 'è«‹é¸æ“‡è©•åˆ†', 'error');
                return;
            }

            showStatus('rating-response', 'æäº¤è©•åˆ†ä¸­...', 'info');

            const result = await apiRequest(`/comments/rate/${testPostId}`, {
                method: 'POST',
                body: JSON.stringify({ rating: selectedRating })
            });

            if (result.success) {
                showStatus('rating-response', `âœ… è©•åˆ†æˆåŠŸ: ${selectedRating} æ˜Ÿ`, 'success');
            } else {
                showStatus('rating-response', `âŒ è©•åˆ†å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testGetUserRating() {
            if (!authToken) {
                showStatus('rating-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const result = await apiRequest(`/comments/rating/${testPostId}/user`);

            if (result.success) {
                const rating = result.data.rating;
                if (rating) {
                    selectedRating = rating;
                    updateStarDisplay(rating);
                    showStatus('rating-response', `âœ… æ‚¨çš„è©•åˆ†: ${rating} æ˜Ÿ`, 'success');
                } else {
                    showStatus('rating-response', 'âœ… æ‚¨å°šæœªè©•åˆ†æ­¤æ–‡ç« ', 'info');
                }
            } else {
                showStatus('rating-response', `âŒ æŸ¥è©¢å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // ç™¼è¡¨ç•™è¨€
        async function testPostComment() {
            if (!authToken) {
                showStatus('comment-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const title = document.getElementById('comment-title').value;
            const content = document.getElementById('comment-content').value;
            const rating = document.getElementById('comment-rating').value;

            if (!content.trim()) {
                showStatus('comment-response', 'è«‹è¼¸å…¥ç•™è¨€å…§å®¹', 'error');
                return;
            }

            showStatus('comment-response', 'ç™¼è¡¨ä¸­...', 'info');

            const requestBody = { content };
            
            // å¦‚æœæœ‰æ¨™é¡Œï¼ŒåŠ å…¥è«‹æ±‚
            if (title.trim()) {
                requestBody.title = title.trim();
            }
            
            if (rating) {
                requestBody.rating = parseInt(rating);
            }

            const result = await apiRequest(`/comments/post/${testPostId}`, {
                method: 'POST',
                body: JSON.stringify(requestBody)
            });

            if (result.success) {
                showStatus('comment-response', 'âœ… ç•™è¨€ç™¼è¡¨æˆåŠŸ', 'success');
                document.getElementById('comment-title').value = '';
                document.getElementById('comment-content').value = '';
                document.getElementById('comment-rating').value = '';
                
                // å¦‚æœæœ‰ç•™è¨€ IDï¼Œé¡¯ç¤ºçµ¦ç”¨æˆ¶
                if (result.data.comment?._id) {
                    showStatus('comment-response', `âœ… ç•™è¨€ç™¼è¡¨æˆåŠŸ (ID: ${result.data.comment._id})`, 'success');
                }
            } else {
                showStatus('comment-response', `âŒ ç™¼è¡¨å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // å›è¦†ç•™è¨€
        async function testReplyComment() {
            if (!authToken) {
                showStatus('reply-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            const parentId = document.getElementById('parent-comment-id').value;
            const content = document.getElementById('reply-content').value;

            if (!parentId || !content.trim()) {
                showStatus('reply-response', 'è«‹å¡«å¯«çˆ¶ç•™è¨€ ID å’Œå›è¦†å…§å®¹', 'error');
                return;
            }

            showStatus('reply-response', 'å›è¦†ä¸­...', 'info');

            const result = await apiRequest(`/comments/post/${testPostId}`, {
                method: 'POST',
                body: JSON.stringify({
                    content,
                    parentComment: parentId
                })
            });

            if (result.success) {
                showStatus('reply-response', 'âœ… å›è¦†ç™¼è¡¨æˆåŠŸ', 'success');
                document.getElementById('reply-content').value = '';
            } else {
                showStatus('reply-response', `âŒ å›è¦†å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // æŸ¥è©¢ç•™è¨€
        async function testGetComments(page = 1) {
            showStatus('comments-response', 'è¼‰å…¥ä¸­...', 'info');

            const result = await apiRequest(`/comments/post/${testPostId}?page=${page}`);

            if (result.success) {
                showStatus('comments-response', `âœ… è¼‰å…¥æˆåŠŸ (ç¬¬ ${page} é )`, 'success');
                displayComments(result.data);
            } else {
                showStatus('comments-response', `âŒ è¼‰å…¥å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        function displayComments(data) {
            const commentsDisplay = document.getElementById('comments-display');
            const commentsContent = document.getElementById('comments-content');
            
            commentsDisplay.style.display = 'block';
            
            // é¡¯ç¤ºè©•åˆ†çµ±è¨ˆ
            let ratingInfo = '';
            if (data.ratings && data.ratings.totalRatings > 0) {
                const avgRating = data.ratings.averageRating.toFixed(1);
                const stars = 'â˜…'.repeat(Math.round(data.ratings.averageRating)) + 
                              'â˜†'.repeat(5 - Math.round(data.ratings.averageRating));
                ratingInfo = `<p><strong>è©•åˆ†çµ±è¨ˆ:</strong> ${stars} ${avgRating}/5 (${data.ratings.totalRatings} å€‹è©•åˆ†)</p>`;
            } else {
                ratingInfo = '<p><strong>è©•åˆ†çµ±è¨ˆ:</strong> å°šç„¡è©•åˆ†</p>';
            }

            // é¡¯ç¤ºç•™è¨€
            let commentsHTML = ratingInfo;
            
            if (data.comments && data.comments.length > 0) {
                commentsHTML += `<p><strong>ç•™è¨€æ•¸:</strong> ${data.pagination.totalComments}</p>`;
                
                data.comments.forEach(comment => {
                    commentsHTML += renderComment(comment);
                });
                
                // åˆ†é è³‡è¨Š
                if (data.pagination.totalPages > 1) {
                    commentsHTML += `<p><strong>åˆ†é :</strong> ç¬¬ ${data.pagination.currentPage} é ï¼Œå…± ${data.pagination.totalPages} é </p>`;
                }
            } else {
                commentsHTML += '<p>æš«ç„¡ç•™è¨€</p>';
            }
            
            commentsContent.innerHTML = commentsHTML;
        }

        function renderComment(comment, isReply = false) {
            const ratingDisplay = comment.rating ? `<span style="color: #ffc107;">â˜…${comment.rating}</span>` : '';
            const replyClass = isReply ? 'reply' : '';
            const titleDisplay = comment.title ? `<div style="font-weight: bold; margin-bottom: 0.5rem; color: #2c3e50;">${comment.title}</div>` : '';
            
            let html = `
                <div class="comment-item ${replyClass}">
                    <div class="comment-header">
                        <strong>${comment.author.nickname}</strong>
                        <span>${new Date(comment.createdAt).toLocaleString()}</span>
                        ${ratingDisplay}
                        <small style="color: #666;">(ID: ${comment._id})</small>
                    </div>
                    ${titleDisplay}
                    <div class="comment-content">${comment.content}</div>
                </div>
            `;
            
            // è™•ç†å›è¦†
            if (comment.replies && comment.replies.length > 0) {
                comment.replies.forEach(reply => {
                    html += renderComment(reply, true);
                });
            }
            
            return html;
        }

        // ç®¡ç†åŠŸèƒ½
        async function testAdminDashboard() {
            if (!authToken) {
                showStatus('admin-dashboard-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('admin-dashboard-response', 'è¼‰å…¥ä¸­...', 'info');

            const result = await apiRequest('/admin/dashboard');

            if (result.success) {
                showStatus('admin-dashboard-response', 'âœ… ç®¡ç†é¢æ¿è¼‰å…¥æˆåŠŸ', 'success');
            } else {
                showStatus('admin-dashboard-response', `âŒ è¼‰å…¥å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testGetUsers() {
            if (!authToken) {
                showStatus('users-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('users-response', 'æŸ¥è©¢ä¸­...', 'info');

            const result = await apiRequest('/admin/users');

            if (result.success) {
                showStatus('users-response', `âœ… æŸ¥è©¢æˆåŠŸï¼Œå…± ${result.data.users.length} å€‹ç”¨æˆ¶`, 'success');
            } else {
                showStatus('users-response', `âŒ æŸ¥è©¢å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testSearchUsers() {
            const search = document.getElementById('user-search').value;
            if (!search) {
                showStatus('users-response', 'è«‹è¼¸å…¥æœå°‹é—œéµå­—', 'error');
                return;
            }

            const result = await apiRequest(`/admin/users?search=${encodeURIComponent(search)}`);

            if (result.success) {
                showStatus('users-response', `âœ… æœå°‹æˆåŠŸï¼Œæ‰¾åˆ° ${result.data.users.length} å€‹ç”¨æˆ¶`, 'success');
            } else {
                showStatus('users-response', `âŒ æœå°‹å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testGetAdminComments() {
            if (!authToken) {
                showStatus('admin-comments-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('admin-comments-response', 'æŸ¥è©¢ä¸­...', 'info');

            const result = await apiRequest('/admin/comments?includeHidden=true');

            if (result.success) {
                showStatus('admin-comments-response', `âœ… æŸ¥è©¢æˆåŠŸï¼Œå…± ${result.data.comments.length} å€‹ç•™è¨€`, 'success');
            } else {
                showStatus('admin-comments-response', `âŒ æŸ¥è©¢å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testHideComment() {
            const commentId = document.getElementById('manage-comment-id').value;
            if (!commentId) {
                showStatus('admin-comments-response', 'è«‹è¼¸å…¥ç•™è¨€ ID', 'error');
                return;
            }

            const result = await apiRequest(`/admin/comments/${commentId}/hide`, {
                method: 'PUT',
                body: JSON.stringify({ isHidden: true })
            });

            if (result.success) {
                showStatus('admin-comments-response', 'âœ… ç•™è¨€å·²éš±è—', 'success');
            } else {
                showStatus('admin-comments-response', `âŒ æ“ä½œå¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testDeleteAdminComment() {
            const commentId = document.getElementById('manage-comment-id').value;
            if (!commentId) {
                showStatus('admin-comments-response', 'è«‹è¼¸å…¥ç•™è¨€ ID', 'error');
                return;
            }

            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç•™è¨€å—ï¼Ÿ')) {
                return;
            }

            const result = await apiRequest(`/admin/comments/${commentId}`, {
                method: 'DELETE'
            });

            if (result.success) {
                showStatus('admin-comments-response', 'âœ… ç•™è¨€å·²åˆªé™¤', 'success');
            } else {
                showStatus('admin-comments-response', `âŒ åˆªé™¤å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        async function testGetStats() {
            if (!authToken) {
                showStatus('stats-response', 'è«‹å…ˆç™»å…¥', 'error');
                return;
            }

            showStatus('stats-response', 'è¼‰å…¥ä¸­...', 'info');

            const result = await apiRequest('/admin/stats');

            if (result.success) {
                showStatus('stats-response', 'âœ… çµ±è¨ˆè³‡æ–™è¼‰å…¥æˆåŠŸ', 'success');
            } else {
                showStatus('stats-response', `âŒ è¼‰å…¥å¤±æ•—: ${result.data?.error || result.error}`, 'error');
            }
        }

        // æ›´æ–°ç”¨æˆ¶é¡¯ç¤º
        function updateUserDisplay() {
            const userInfo = document.getElementById('user-info');
            const currentUserDiv = document.getElementById('current-user');

            if (currentUser) {
                userInfo.style.display = 'block';
                currentUserDiv.innerHTML = `
                    <p><strong>æš±ç¨±:</strong> ${currentUser.nickname}</p>
                    <p><strong>é›»å­ä¿¡ç®±:</strong> ${currentUser.email}</p>
                    <p><strong>è§’è‰²:</strong> ${currentUser.role}</p>
                    <p><strong>æ¬Šé™:</strong> 
                        ç•™è¨€:${currentUser.permissions?.canComment ? 'âœ…' : 'âŒ'} | 
                        è©•åˆ†:${currentUser.permissions?.canRate ? 'âœ…' : 'âŒ'} | 
                        ç™¼æ–‡:${currentUser.permissions?.canPost ? 'âœ…' : 'âŒ'}
                    </p>
                `;
            } else {
                userInfo.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initRatingStars();
            
            // å¦‚æœæœ‰ tokenï¼Œå˜—è©¦è¼‰å…¥ç”¨æˆ¶è³‡è¨Š
            if (authToken) {
                testGetUserInfo();
            }
            
            // è¨­å®šåˆå§‹æ–‡ç«  ID
            setTestPostId();
            
            // é¡¯ç¤ºæ­¡è¿è¨Šæ¯
            logAPI('ğŸ‰ æ¸¬è©¦é é¢å·²è¼‰å…¥', { message: 'æ‚¨å¯ä»¥é–‹å§‹æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½äº†ï¼' }, 'success');
        });
    </script>
</body>
</html>